<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8">
    <meta name="description" content="The HTML5 Herald">
    <meta name="author" content="SitePoint">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <style>
      body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
    </style>
    <header>
      <center>
      <h1><b><a href="https://github.com/dedis/drand">DRAND</a></b></h1>
      <h3>(experimental) Distributed Randomness Beacon Daemon</h3>
    </center>
    </header>
</head>
<body>
    <div id="loader"></div>
    <script src="../libraries/JSPairings/public_html/BigInteger.js"></script>
    <script src="../libraries/JSPairings/public_html/PRNG4.js"></script>
    <script src="../libraries/JSPairings/public_html/RNG.js"></script>
    <script src="../libraries/JSPairings/public_html/JSPoint.js"></script>
    <script src="../libraries/JSPairings/public_html/JSField2.js"></script>
    <script src="../libraries/JSPairings/public_html/JSField4.js"></script>
    <script src="../libraries/JSPairings/public_html/JSField6.js"></script>
    <script src="../libraries/JSPairings/public_html/JSField12.js"></script>
    <script src="../libraries/JSPairings/public_html/JSParams.js"></script>
    <script src="../libraries/JSPairings/public_html/JSCurve.js"></script>
    <script src="../libraries/JSPairings/public_html/JSPoint2.js"></script>
    <script src="../libraries/JSPairings/public_html/JSCurve2.js"></script>
    <script src="../libraries/JSPairings/public_html/JSPairing.js"></script>
    <script src="../javascript/helpers.js"></script>
    <script src="../javascript/drand.js"></script>
    <div id="printDiv">
    </div>
    <script>
      const div = document.querySelector('#printDiv');
      var lastRound = "0";

      function testFetchKeyAndPublic() {
        identity = {Address: "127.0.0.1:8000", TLS: false}
        fetchAndVerify(identity)
          .then(function (fulfilled) {
            randomness = fulfilled[0]
            round = fulfilled[1]
            if (round == lastRound || round == undefined) {
              return
            }
            lastRound = round;
            var textnode = document.createTextNode('(' + round + ') ' + randomness + ' : verified.');
            var p = document.createElement("p");
            p.appendChild(textnode);
            document.getElementById("loader").style.display = "none";
            div.appendChild(p);
        })
          .catch(function (error) {
            randomness = error[0]
            round = error[1]
            if (round == lastRound || round == undefined) {
              return
            }
            lastRound = round;
            var textnode = document.createTextNode('(' + round + ') ' + randomness + ' : not verified.');
            var p = document.createElement("p");
            p.appendChild(textnode);
            document.getElementById("loader").style.display = "none";
            div.appendChild(p);
        });
      }

      function testFetchAndVerifyWithKey() {
        identity = {Address: "127.0.0.1:8000", TLS: false, Key: "017f2254bc09a999661f92457122613adb773a6b7c74333a59bde7dd552a7eac2a79263bb6fb1f3840218f3181218b952e2af35be09edaee66566b458c92609f7571e8bb519c9109055b84f392c9e84f5bb828f988ce0423ce708be1dcf808d9cc63a610352b504115ee38bc23dd259e88a5d1221d53e45c9520be9b601fb4f578"}
        fetchAndVerifyWithKey(identity)
          .then(function (fulfilled) {
            randomness = fulfilled[0]
            round = fulfilled[1]
            if (round == lastRound || round == undefined) {
              return
            }
            lastRound = round;
            var textnode = document.createTextNode('(' + round + ') ' + randomness + ' : verified.');
            var p = document.createElement("p");
            p.appendChild(textnode);
            document.getElementById("loader").style.display = "none";
            div.appendChild(p);
        })
          .catch(function (error) {
            randomness = error[0]
            round = error[1]
            if (round == lastRound || round == undefined) {
              return
            }
            lastRound = round;
            var textnode = document.createTextNode('(' + round + ') ' + randomness + ' : not verified.');
            var p = document.createElement("p");
            p.appendChild(textnode);
            document.getElementById("loader").style.display = "none";
            div.appendChild(p);
        });
      }

      function wrap() {
        testFetchKeyAndPublic()
        //testFetchAndVerifyWithKey()
      }

      wrap();
      window.setInterval(wrap,60000);
    </script>
</body>
</html>
